<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<style type="text/css">
body{margin:0;padding:0;background:#000;font-family:monospace;-webkit-touch-callout:none;user-select:none;overflow:hidden;} 
canvas{position:absolute;left:50%;top:50%;background:transparent;display:none;image-rendering:pixelated;image-rendering: } 
h1{left:0;line-height:200px;margin:auto;margin-top:-100px;position:absolute;top:50%; width:100%;text-align: center;} 
#l{color:#fff;font-size: 150%;}
</style></head><body>
<div id="l"><h1 id="h">Loading</h1></div><div id="fs"></div><canvas></canvas>


<script>!function(){"use strict";class t{constructor(t){this.images=t,this.loaded=[],this.loadedImgs=0,this.totalImgs=Object.keys(t).length}start(){return new Promise((t,i)=>{this.resolve=t,this.reject=i,this.loadImages(this.images)})}loadImages(t){Object.keys(t).forEach(i=>{this.loaded[i]=new Image,this.loaded[i].onload=this.checkLoaded(),this.loaded[i].src="data:image/gif;base64,R0lGODlh"+t[i]})}checkLoaded(){this.loadedImgs+=1,this.loadedImgs===this.totalImgs&&setTimeout(()=>this.resolve(this.loaded),25)}}class i{constructor(t,i){return this.w=t,this.h=i,this.c=document.getElementsByTagName("canvas")[0],this.ctx=this.c.getContext("2d",{alpha:!1}),this.c.width=t,this.c.height=i,this.c.style.width=`${t}px`,this.c.style.height=`${i}px`,window.addEventListener("resize",()=>{this.resize()}),window.addEventListener("fullscreenchange",()=>{this.resize()}),this.resize(),{c:this.c,ctx:this.ctx}}resize(){const t=this.w/this.h,i=this.c.style;let s=window.innerWidth,h=window.innerHeight;s/h>t?(s=h*t,i.height=`${h}px`,i.width=`${s}px`):(h=s/t,i.width=`${s}px`,i.height=`${h}px`),i.marginTop=`${-h/2}px`,i.marginLeft=`${-s/2}px`,i.transformOrigin="0 0",i.transform="scale(1)"}}var s={timeStamp:()=>window.performance.now(),rnd:(t,i)=>Math.floor(Math.random()*(i-t+1)+t),rndArray:t=>t[~~(Math.random()*t.length)],mkCanvas(t,i){const s=document.createElement("canvas"),h=s.getContext("2d");return s.width=t,s.height=i,h.mozImageSmoothingEnabled=!1,h.imageSmoothingEnabled=!1,s}};class h{constructor(t,i,s){this.pal=s,this.c=t,this.ctx=i}clear(t){let i=this.pal[t];this.ctx.fillStyle=`rgb(${i[0]},${i[1]},${i[2]})`,this.ctx.fillRect(0,0,this.c.width,this.c.height)}rect(t,i,s,h,e){let a=this.pal[e];this.ctx.fillStyle=`rgb(${a[0]},${a[1]},${a[2]})`,this.ctx.fillRect(~~t,~~i,s,h)}img(t,i,s,h=!1){h&&(t=this.resize(t,h)),this.ctx.drawImage(t,~~i,~~s)}flip(t,i,h){let e=s.mkCanvas(t.width,t.height),a=e.getContext("2d"),r=i?-1:1,n=h?-1:1,o=i?-1*t.width:0,l=h?-1*t.height:0;return e.width=t.width,e.height=t.height,a.save(),a.scale(r,n),a.drawImage(t,o,l,t.width,t.height),a.restore(),e}resize(t,i){let h=s.mkCanvas(t.width*i,t.height*i),e=h.getContext("2d");return h.width&&(e.save(),e.scale(i,i),e.drawImage(t,0,0),e.restore()),h.scale=i,h}color(t,i){const h=s.mkCanvas(t.width,t.height),e=h.getContext("2d");let a,r=0;for(e.drawImage(t,0,0),a=e.getImageData(0,0,t.width,t.height),r=0;r<a.data.length;r+=4)a.data[r+0]=i[0],a.data[r+1]=i[1],a.data[r+2]=i[2];return e.putImageData(a,0,0),h}textWidth(t,i){return t.length*(3*i.scale)+t.length*(1*i.scale)}text(t,i,s,h){let e=0,a=this.ctx,r=0,n=3*i.scale,o=5*i.scale,l=1*i.scale,A=this.textWidth(t,i),c=0;const d="0123456789".split("");for("number"!=typeof t&&"0"!==t[0]||(t+="",r=43),s=s||(this.c.width-A)/2,e=0;e<t.length;e+=1)r="number"==typeof t[e]||"0"===t[e]||-1!==d.indexOf(t[e])?43:0,(c=(t.charCodeAt(e)-65+r)*(n+l))>-1&&a.drawImage(i,c,0,n,o,~~s,~~h,n,o),s+=n+l}}class e{constructor(t,i){let s=window.addEventListener,h=this;this.c=t,this.g=i,this.keys=[],this.m={x:i.w/2,y:i.h/2,click:0,touches:[],w:1,h:1},s("keydown",t=>{this.keys[t.key]=!0}),s("keyup",t=>{this.keys[t.key]=!1}),s("mousemove",t=>{this.trackMove(t)}),s("mousedown",()=>{this.m.click=1}),s("mouseup",()=>{this.m.click=0}),s("touchstart",function(t){h.touching=1,h.trackTouch(t.touches)}),s("touchmove",function(t){t.preventDefault(),h.trackTouch(t.touches)}),s("touchend",function(t){t.preventDefault(),h.trackTouch(t.touches),h.touching=0})}trackMove(t){let i=this.g,s=i.canvas.c,h=s.offsetTop,e=s.offsetLeft,a=parseInt(s.style.width,10)/s.width,r=~~((t.pageX-e)/a),n=~~((t.pageY-h)/a);r=(r=r>i.w?i.w:r)<0?0:r,n=(n=n>i.h?i.h:n)<0?0:n,this.m.x=~~r,this.m.y=~~n}trackTouch(t){let i,s,h,e=this.g.canvas.c,a=e.offsetTop,r=e.offsetLeft,n=parseInt(e.style.width,10)/e.width;for(this.m.touches=[],h=0;h<t.length&&!(h>2);h+=1)i=~~((t[h].pageX-r)/n),s=~~((t[h].pageY-a)/n),this.m.touches.push({x:i,y:s,w:1,h:1})}}var a=new function(){var t,i,s,h,e,a,r,n,o,l,A,c,d=this;this._params=new function(){this.set=function(t){for(var i=0;24>i;i++)this[String.fromCharCode(97+i)]=t[i]||0;this.c<.01&&(this.c=.01);var s=this.b+this.c+this.e;if(.18>s){var h=.18/s;this.b*=h,this.c*=h,this.e*=h}}},d.r=function(){var t=d._params;h=100/(t.f*t.f+.001),e=100/(t.g*t.g+.001),a=1-t.h*t.h*t.h*.01,r=-t.i*t.i*t.i*1e-6,t.a||(A=.5-t.n/2,c=5e-5*-t.o),n=1+t.l*t.l*(t.l>0?-.9:10),o=0,l=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},d.tr=function(){d.r();var h=d._params;return t=h.b*h.b*1e5,i=h.c*h.c*1e5,s=h.e*h.e*1e5+12,3*((t+i+s)/3|0)},d.s=function(g,p){var m=d._params,u=1!=m.s||m.v,f=m.v*m.v*.1,w=1+3e-4*m.w,x=m.s*m.s*m.s*.1,y=1+1e-4*m.t,v=1!=m.s,E=m.x*m.x,I=m.g,b=m.q||m.r,H=m.r*m.r*m.r*.2,B=m.q*m.q*(m.q<0?-1020:1020),G=m.p?32+((1-m.p)*(1-m.p)*2e4|0):0,S=m.d,C=m.j/2,k=m.k*m.k*.01,M=m.a,T=t,O=1/t,L=1/i,_=1/s,D=5/(1+m.u*m.u*20)*(.01+x);D>.8&&(D=.8),D=1-D;for(var R,K,P,W,Y,j,z=!1,N=0,U=0,F=0,q=0,$=0,J=0,V=0,X=0,Q=0,Z=0,tt=new Array(1024),it=new Array(32),st=tt.length;st--;)tt[st]=0;for(st=it.length;st--;)it[st]=2*Math.random()-1;for(st=0;p>st;st++){if(z)return st;if(G&&++Q>=G&&(Q=0,d.r()),l&&++o>=l&&(l=0,h*=n),(h*=a+=r)>e&&(h=e,I>0&&(z=!0)),K=h,C>0&&(Z+=k,K*=1+Math.sin(Z)*C),8>(K|=0)&&(K=8),M||(0>(A+=c)?A=0:A>.5&&(A=.5)),++U>T)switch(U=0,++N){case 1:T=i;break;case 2:T=s}switch(N){case 0:F=U*O;break;case 1:F=1+2*(1-U*L)*S;break;case 2:F=1-U*_;break;case 3:F=0,z=!0}b&&(0>(P=0|(B+=H))?P=-P:P>1023&&(P=1023)),u&&w&&(1e-5>(f*=w)?f=1e-5:f>.1&&(f=.1)),j=0;for(var ht=8;ht--;){if(++V>=K&&(V%=K,3==M))for(var et=it.length;et--;)it[et]=2*Math.random()-1;switch(M){case 0:Y=A>V/K?.5:-.5;break;case 1:Y=1-V/K*2;break;case 2:Y=.225*((0>(Y=1.27323954*(W=6.28318531*((W=V/K)>.5?W-1:W))+.405284735*W*W*(0>W?1:-1))?-1:1)*Y*Y-Y)+Y;break;case 3:Y=it[Math.abs(32*V/K|0)]}u&&(R=J,0>(x*=y)?x=0:x>.1&&(x=.1),v?($+=(Y-J)*x,$*=D):(J=Y,$=0),q+=(J+=$)-R,Y=q*=1-f),b&&(tt[X%1024]=Y,Y+=tt[(X-P+1024)%1024],X++),j+=Y}j*=.125*F*E,g[st]=j>=1?32767:-1>=j?-32768:32767*j|0}return p}};const r={init(t,i){let s=window,h=s.AudioContext||s.webkitAudioContextx;this.ctx=!!h&&new h,this.g=t,this.ctx&&this.encode(i)},encode(t){let i=this;i.sounds=[];const s=t=>{let i,s,h;for(t=function(t){a._params.set(t);var i=a.tr(),s=new Uint8Array(4*((i+1)/2|0)+44),h=2*a.s(new Uint16Array(s.buffer,44),i),e=new Uint32Array(s.buffer,0,44);e[0]=1179011410,e[1]=h+36,e[2]=1163280727,e[3]=544501094,e[4]=16,e[5]=65537,e[6]=44100,e[7]=88200,e[8]=1048578,e[9]=1635017060,e[10]=h,h+=44;for(var r=0,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="data:audio/wav;base64,";h>r;r+=3){var l=s[r]<<16|s[r+1]<<8|s[r+2];o+=n[l>>18]+n[l>>12&63]+n[l>>6&63]+n[63&l]}return o}(t),i=(t=atob(t.substr(t.indexOf(",")+1))).length,s=new Uint8Array(i),h=0;h<i;h++)s[h]=t.charCodeAt(h);return s.buffer};var h;Object.keys(t).forEach(h=>{h=h,i.ctx.decodeAudioData(s(t[h]),t=>{i.sounds[h]=t})})},play(t){if(this.ctx&&this.sounds[t]){let i=this.ctx.createBufferSource();i.buffer=this.sounds[t],i.connect(this.ctx.destination),i.start(0)}}};var n=/^([A-Z]{3})/,o=/([A-GX]#?)([1-8])([1-9]{1,2})/g,l=new Map([["C",16.35],["C#",17.32],["D",18.35],["D#",19.45],["E",20.6],["F",21.83],["F#",23.12],["G",24.5],["G#",25.96],["A",27.5],["A#",29.14],["B",30.87],["X",0]]);function A(t,i,s){this.audioContext=s||new(window.AudioContext||webkitAudioContext),this.instruments=t,this.tracks=i,this.oscillators=[]}A.prototype.play=function(t){this.stop();for(var i=this.tracks[t],s=new Array(i.parts.length),h=0;h<i.parts.length;h++){var e=this.instruments[this._parseInstrument(i.parts[h])],a=this._parseFreqs(i.parts[h],i.bpm);s[h]=this._createOscillator(e),this._enqueueFreqs(s[h],a,i.isLooping)}this.oscillators=s},A.prototype.stop=function(){for(var t=0;t<this.oscillators.length;t++)this.oscillators[t].stop()},A.prototype._parseInstrument=function(t){return t.match(n)[1]},A.prototype._parseFreqs=function(t,i){for(var s=[],h=void 0;h=o.exec(t);){var e=h[1],a=h[2],r=h[3];s.push({length:this._getFreqLength(r,i),hz:this._convertToFrequency(e,a,r)})}return s},A.prototype._getFreqLength=function(t,i){var s=i/60;return parseInt(t)/s/4},A.prototype._convertToFrequency=function(t,i,s){return l.get(t)*Math.pow(1.059463094359,12*i)},A.prototype._createOscillator=function(t){var i=this.audioContext.createOscillator();i.type=t.wave,i.frequency.value=0;var s=this._applyGain(i,t.gain);return(s=this._applyPan(s,t.pan)).connect(this.audioContext.destination),i.start(),i},A.prototype._enqueueFreqs=function(t,i,s){for(var h=this,e=0,a=0;a<i.length;a++){var r=i[a];t.frequency.setValueAtTime(i[a].hz,this.audioContext.currentTime+e),e+=r.length}setTimeout(function(){if(!s)return h.stop(),void(h.onStop&&h.onStop());h._enqueueFreqs(t,i,s)},1e3*Math.round(e))},A.prototype._applyGain=function(t,i){return this._applyEffect(t,i,"createGain","gain")},A.prototype._applyPan=function(t,i){return this._applyEffect(t,i,"createStereoPanner","pan")},A.prototype._applyEffect=function(t,i,s,h){if(!i||!this.audioContext[s])return t;var e=this.audioContext[s]();return e[h].value=i,t.connect(e),e};class c{constructor(t,i){this.g=t,this.bgSpeed=i.speed,this.bgFloor=i.floor,this.name=i.name,this.generate(i.x),this.bg=[],this.fg=[]}update(t){"sun"===this.name?(this.y+=this.vy,(this.y>1.6*this.g.h||this.y<0)&&(this.vy*=-1)):(this.x-=this.speed*this.bgSpeed*(100*t),this.x<-this.i.width*this.scale&&this.generate())}generate(t=!1){"flower"===this.name?this.flower(t):"bush"===this.name?this.bush(t):"cloud"===this.name?this.cloud(t):"sun"===this.name?this.sun(t):"star"===this.name&&this.star(t)}cloud(t){let i=this.g;this.scale=i.H.rnd(2,4),this.i=i.imgs[`circle_${this.scale}_2`],this.speed=.05*this.scale,this.x=t||this.g.w+i.H.rnd(1,this.i.width*this.scale*3),this.y=i.H.rnd(this.i.height*this.scale,i.h/2),this.hw=this.i.width/2}bush(t){let i=this.g;this.scale=i.H.rnd(5,9),this.i=i.imgs[`circle_${this.scale}_10`],this.speed=0,this.x=t||i.w+i.H.rnd(1,this.i.width*this.scale*3),this.y=i.h-120}sun(){let t=this.g;this.i=t.imgs.circle_12_8,this.speed=0,this.x=t.w/2.5,this.y=0,this.vy=.1}flower(t){let i=this.g;this.scale=i.H.rnd(1,3),this.i=i.imgs[`star_${this.scale}_10`],this.x=i.H.rnd(10,i.w-10),this.y=i.h-this.bgFloor+this.i.height*this.scale*1.2}star(t){let i=this.g;this.scale=i.H.rnd(1,3),this.i=i.imgs[`star_${this.scale}_2`],this.x=i.H.rnd(40,i.w-40),this.y=i.H.rnd(0,i.h/2),this.speed=0}}var d=[{title:"The Park",col:{bg:15,ground:11},floor:100,v:{x:2,y:0},bg:[{num:1,name:"sun"},{num:3,name:"bush"},{num:4,name:"cloud"},{num:8,name:"star"}],fg:[{num:8,name:"flower"}],tree:[16,15,370],nest:[38,40],bird:[38,200],ledges:[{w:15,x:32,y:58},{w:20,x:32,y:200},{w:30,x:32,y:300}],events:[{t:1e3,n:"Baddie",d:{i:"hornet",yRange:200}},{t:2e3,n:"Baddie",d:{i:"hornet",yRange:300}},{t:3e3,n:"Baddie",d:{i:"hornet",yRange:100}},{t:5e3,n:"Cat",d:{}},{t:7e3,n:"Baddie",d:{i:"gull",yRange:100}},{t:8e3,n:"Baddie",d:{i:"hornet",yRange:50}}]}];class g{constructor(t,i){this.p=t,this.g=t.g,this.init(i),this.c=this.g.H.mkCanvas(this.g.w,this.g.h),this.ctx=this.c.getContext("2d"),this.draw=new h(this.c,this.ctx,this.g.data.pal)}init(t){this.bg=[],this.fg=[],this.level=d[t-1];let i=this.level.v.x,s=this.level.floor;this.level.bg.forEach(t=>{let h=t.num;for(;h--;){let e=this.g.w/4*h,a=t.name;this.bg.push(new c(this.g,{x:e,name:a,speed:i,floor:s}))}}),this.level.fg.forEach(t=>{let h=t.num;for(;h--;){let e=this.g.w/4*h,a=t.name;this.fg.push(new c(this.g,{x:e,name:a,speed:i,floor:s}))}}),this.sun=this.bg[0]}update(t){this.bg.forEach(i=>i.update(t));let i=this.g.h-~~this.sun.y,s=15;i<120?s=9:i<130?s=3:i<140?s=7:i<150?s=4:i<160?s=8:i<170&&(s=15),this.level.col.bg=s}render(t){let i=this.g,s=this.draw,h=this.level;s.clear(h.col.bg),this.bg.forEach(t=>{"cloud"===t.name&&(s.img(t.i,t.x-t.i.width,t.y),s.img(t.i,t.x-t.hw,t.y-t.hw)),"star"===t.name?15!==h.col.bg&&s.img(t.i,t.x,t.y):s.img(t.i,t.x,t.y)}),s.rect(0,i.h-h.floor,i.w,i.h,h.col.ground),this.fg.forEach(t=>{s.img(t.i,t.x,t.y)}),this.g.draw.img(this.c,0,0)}}class p{constructor(t,i){this.g=t,this.o=i,this.id=`id-${Math.random().toString(36).substr(2,16)}`,this.dead=!1,this.remove=!1,this.offsetY=0,this.name=i.i;for(let t in i)this[t]=i[t];this.lastPos={x:this.x,y:this.y},this.flip={x:0,y:0},this.scale=i.scale||1,this.frame=i.frame||1,this.frames=i.frames||1,this.frameRate=i.frameRate||80,this.frameNext=i.frameNext||0,this.mkImg(i.i),this.hurt=!1,this.anims={idle:{frames:[1],rate:80}},this.changeAnim("idle")}update(t){this.collidesWith&&this.collidesWith.forEach(t=>{this.hitGroup(t)}),this.updateAnim(t)}render(){let t=this.g,i=this.hurt?this.iHurt:this.i,s=this.frame;i?(this.flip.y&&(i=t.draw.flip(i,0,1)),this.flip.x&&(i=t.draw.flip(i,1,0),s=this.frames-this.frame+1),t.draw.ctx.drawImage(i,s*this.w-this.w,0,this.w,this.h,~~this.x,~~this.y+this.offsetY,this.w,this.h)):t.draw.rect(this.x,this.y,this.w,this.h,this.col)}updateAnim(t){this.frameNext<0&&(this.frameNext=this.anim.rate,this.anim.counter+=1,this.anim.counter>=this.anim.frames.length&&(this.anim.next?this.changeAnim(this.anim.next):this.anim.counter=0),this.frame=this.anim.frames[this.anim.counter]),this.frameNext-=this.g.dt}hitGroup(t){this.g.ents.forEach(i=>{i&&i.group===t&&i.id!==this.id&&this.hit(i)&&(this.receiveDamage(i),i.doDamage(this))})}hit(t){return!(t.y+t.h<this.y||t.y>this.y+this.h||t.x+t.w<this.x||t.x>this.x+this.w)}receiveDamage(t){}doDamage(t){}isOffScreen(){let t=this.g;return this.x<-this.w||this.x>t.w+this.w||this.y<-this.h||this.y>t.h+this.h}kill(){this.dead=this.remove=!0}mkImg(t){if(!this.i)return;let i=this.g;this.i=i.draw.resize(i.imgs[t],this.scale),this.w=this.i.width/this.frames,this.h=this.i.height,this.iHurt=i.draw.color(this.i,i.data.pal[3])}changeAnim(t){this.anim&&this.anim.name&&this.anim.name===t||(this.anim=this.anims[t],this.anim.name=t,this.anim.counter=0,this.frame=this.anim.frames[0],this.frameNext=this.anim.rate)}}const m={title:"ENJOY THE SUNSHINE",start:"Title",w:320,h:480,pal:[[0,0,0],[157,157,157],[255,255,255],[190,38,51],[224,111,139],[73,60,43],[164,100,34],[235,137,49],[247,226,107],[42,72,78],[68,137,26],[163,206,39],[27,38,50],[0,87,132],[49,162,242],[178,220,239]],i:{b:"HgAGAKEDABsmMuuJMf///zGi8iH5BAEKAAMALAAAAAAeAAYAAAImnI+pywpgXkNA1GgFvqPyJ4EBJIJPcJxQB4zRO0UmC8YTihr4UAAAOw==",bun:"BgAGAMIEAL4mM+Bvi+uJMffiazGi8jGi8jGi8jGi8iH5BAEKAAQALAAAAAAGAAYAAAMNSASgFDC8SCkZAiusEwA7",cat:"EAAIAKECAC9ITr4mMzGi8jGi8iH5BAEKAAIALAAAAAAQAAgAAAIdlI8Gsrh9gEzyxQCCw7pW5k3gp3iRo5xMsq4QaxQAOw==",circle:"CAAIAIABAP///zGi8iH5BAEKAAEALAAAAAAIAAgAAAIMTIBgl8gNo5wvrWYKADs=",ded:"BgAGAKECABsmMuuJMTGi8jGi8iH5BAEKAAIALAAAAAAGAAYAAAILlI8YsuBuXADxiQIAOw==",dir:"BwAHAIABAP///zGi8iH5BAEKAAEALAAAAAAHAAcAAAIMjA1wmcj6WoiLHVcAADs=",dot:"AQABAIABAP///zGi8iH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==",font:"jwAFAIABAAAAADGi8iH5BAEKAAEALAAAAACPAAUAAAJwhGOAd6sZFpowPhrxhZz5x2ji5pRTyVEf+pGXhcFyrGSuvd56du47/KrNbjOgpjNUgVwNoWqYUx6XMl3TcqVha7kVsDWyxU7hXnkq2krEZq46mHSTk0YhCSvtUO2hfR81EoKD1pNFxOWFSPW1mGdQAAA7",gull:"BgADAKEDAL4mM+uJMf///zGi8iH5BAEKAAMALAAAAAAGAAMAAAIIlDaWIJAWUAEAOw==",h0:"GAAIAMIGABsmMkk8K74mM+Bvi/3//P///zGi8jGi8iH5BAEKAAcALAAAAAAYAAgAAAM7eLoawfA4NtW4Y9WDM8cWcRHfpRRXEY6lhw5qZ3ZnYWeDILj2Yt8HgBDA+XmGiyGRqGAim8FkNAJlRhIAOw==",h1:"GAAIAMIGAAUDC74mM6RkIuBvi/3//P///zGi8jGi8iH5BAEKAAcALAAAAAAYAAgAAAM6eLrc/grI6Sa14AAiBMFS0RUT52mdoIkCOaTCgHbKYNuHEATqcS83XNA3JMpqv0wEedQ4l8pHJtpIAAA7",h2:"GAAIAMIFAEk8K74mM+Bvi/fia////zGi8jGi8jGi8iH5BAEKAAcALAAAAAAYAAgAAAM+eLpHTow92J4iIl93s6CY1gAZEH5jeZEC0Hhpe3if8GrOoNdBABG6AShoCw5mQUpwYTwYj04dcxmFRhTUawIAOw==",hat0:"BgAGAKECAKRkIuuJMTGi8jGi8iH5BAEKAAIALAAAAAAGAAYAAAILlG8RqLyyAICqhgIAOw==",hat1:"BgAGAKECAL4mM+BvizGi8jGi8iH5BAEKAAIALAAAAAAGAAYAAAIKlI+JwGABg2itAAA7",hat2:"BgAGAIABAOuJMTGi8iH5BAEKAAEALAAAAAAGAAYAAAIIjI+ZAMcc3isAOw==",heart:"BQAFAIABAL4mMzGi8iH5BAEKAAEALAAAAAAFAAUAAAIIDGygu3mBQgEAOw==",hornet:"CAAEAKEDAAAAALLc7/fiazGi8iH5BAEKAAMALAAAAAAIAAQAAAIMnBdnICEwgHwPRgoLADs=",lolly:"BgAGAKEDAOBvi+uJMf///zGi8iH5BAEKAAMALAAAAAAGAAYAAAIMHDB5p9s8hBRphDoKADs=",lr:"BwAHAIABAP///zGi8iH5BAEKAAEALAAAAAAHAAcAAAIMjA1wmcj6WoiLHVcAADs=",melon:"BgAGAMIEAAAAAL4mM0SJGv///zGi8jGi8jGi8jGi8iH5BAEKAAQALAAAAAAGAAYAAAMOGLoToKMxIYeg0ZJ7SQIAOw==",nest:"CAAGAKECAEk8K6RkIjGi8jGi8iH5BAEKAAIALAAAAAAIAAYAAAINDI5gecueBASihhtqAQA7",phone:"BAAGAKECAAAAAC9ITjGi8jGi8iH5BAEKAAIALAAAAAAEAAYAAAIHhB2BCrlnCgA7",poo:"AwAHAKECAKRkIv///zGi8jGi8iH5BAEKAAIALAAAAAADAAcAAAIJVIR4JhABYhMFADs=",star:"AwADAIABAP///zGi8iH5BAEKAAEALAAAAAADAAMAAAIEDAx3BQA7",ud:"BwAHAIABAP///zGi8iH5BAEKAAEALAAAAAAHAAcAAAILjI+AAX0NDXSz1gIAOw==",worm:"BQAIAKEDAAAAAOBvi////zGi8iH5BAEKAAMALAAAAAAFAAgAAAIPFGYiocoyghxx1kAlvqMAADs="},scale:["circle","star","dot","font"],sfx:{BOOM:[3,,.3532,.6421,.4668,.054,,.2682,,,,,,,,.5503,.0564,-.2946,1,,,,,.5],JUMP:[0,,.2432,,.1709,.3046,,.1919,,,,,,.5923,,,,,1,,,,,.5],POWERUP:[0,,.0129,.5211,.4714,.4234,,,,,,.4355,.5108,,,,,,1,,,,,.5],SHOOT:[2,,.1128,,.178,.7748,.0046,-.4528,,,,,,.185,.0994,,,,1,,,,,.5],TIP:[3,,.026,,.1909,.605,,-.4942,,,,,,,,,,,1,,,.1405,,.5],TAP:[1,,.1953,,.1186,.2659,,,,,,,,,,,,,1,,,.1,,.5]},instruments:{VOX:{wave:"square",pan:-.1,gain:.1},BSS:{wave:"triangle",pan:.5,gain:.7}},tracks:{win:{bpm:120,isLooping:!1,parts:["VOXA41A#41A41A#41G44C54","BSSA41A#41A41A#41G44C54"]},dead:{bpm:120,isLooping:!1,parts:["VOXF31E31D31B31A#24","BSSF31E31D31B31A#24"]},help:{bpm:180,isLooping:!1,parts:["VOXC22C22G12G12A#12A#12B12B12G12E12G14","BSSC22C22G12G12A#12A#12B12B12G12E12G14"]}}};m.states={Title:class{constructor(t){this.g=t,this.title=t.imgs.font_4_0,this.shadow=t.imgs.font_4_8,this.hi=t.imgs.font_4_2,t.initAudio()}init(){this.canStart=!1,this.g.music.play("win"),this.g.spawn("Control",{y:this.g.h-200,x:30,text:"START",cb:()=>{this.g.changeState("Main")}}),this.g.spawn("Control",{y:this.g.h-200,x:180,col:14,clickCol:10,text:"HELP",cb:()=>{this.g.changeState("Help")}}),this.g.addEvent({t:100,cb:()=>{this.canStart=!0}}),this.bg=new g(this,1),this.floor=this.g.h-this.bg.level.floor,this.speed=2,this.h=this.g.spawn("Human",{p:this}),this.h.isHolding="phone",this.h.isWearing=!1}update(t){let i=this.g.input.keys;this.canStart&&(i.x||i.Enter)&&this.g.changeState("Main"),this.bg.update(t),this.bg.bg[0].y=100;for(let i of this.g.ents)i.update(t)}render(){const t=this.g;this.bg.render(),t.draw.text(t.data.title,this.shadow,!1,34),t.draw.text(t.data.title,this.title,!1,30),t.draw.text("GET OFFLINE",t.imgs.font_3_0,!1,72),t.draw.text("GET OFFLINE",t.imgs.font_3_4,!1,70),t.draw.text("HI "+this.g.hiScore,this.hi,!1,t.h-30);for(let t of this.g.ents)t.render()}},Help:class{constructor(t){this.g=t,this.h=t.imgs.font_4_2,this.p=t.imgs.font_2_2}init(){this.g.music.play("help"),this.g.spawn("Control",{y:this.g.h-60,col:11,clickCol:14,text:"DONE",cb:()=>{this.g.changeState("Main")}})}update(t){let i=this.g,s=i.input.keys;this.canStart&&(s.x||s.Enter)&&i.changeState("Main");for(let i of this.g.ents)i.update(t)}render(){let t=this.g,i=t.imgs;t.draw.clear(12),t.draw.text("CONTROLS",this.h,!1,10),t.draw.text(t.mobile?"TAP ON SCREEN BUTTONS":"L R CURSORS",this.p,!1,50),t.draw.text(t.mobile?"":"X TO FLY",this.p,!1,70),t.draw.text("YOUR PURPOSE",this.h,!1,130),t.draw.text("SWOOP DOWN TO STEAL ITEMS",this.p,!1,170),t.draw.img(i.phone,100,190,4),t.draw.img(i.bun,130,190,4),t.draw.img(i.melon,170,190,4),t.draw.img(i.lolly,210,190,4),t.draw.text("THEN DROP IN NEST",this.p,!1,240),t.draw.img(i.nest,150,260,4),t.draw.text("AVOID",this.h,!1,320),t.draw.img(i.hornet,100,360,4),t.draw.img(i.gull,150,360,4),t.draw.ctx.drawImage(i.cat,0,0,8,8,200,360,24,24);for(let i of t.ents)i.render()}},Main:class{constructor(t){this.g=t,this.f=t.imgs.font_6_3,this.ui=t.imgs.font_5_2,this.ui2=t.imgs.font_5_0}init(){let t=this.g;this.score=0,this.floor=20,this.speed=2,this.angle=0,this.gameOver=!1,this.level=1,t.plays+=1,t.audio.play("TIP"),this.bg=new g(this,this.level),this.floor=t.h-this.bg.level.floor,this.ctrl={},this.ctrl.l=t.spawn("Control",{i:"lr",x:20,y:t.h-60}),this.ctrl.r=t.spawn("Control",{i:"lr",x:100,y:t.h-60,flip:!0}),this.ctrl.u=t.spawn("Control",{i:"ud",x:250,y:t.h-60});let i=this.bg.level.bird;this.setUpTree(),this.p1=t.spawn("Bird",{p:this,x:i[0],y:i[1]}),t.spawn("Human",{p:this}),t.spawn("Worm",{p:this,x:200,y:this.floor}),this.setUpEvents()}update(t){this.bg.update(t),this.g.ents.forEach((i,s)=>{i.update(t),i.remove&&this.g.ents.splice(s,1)}),this.p1.lives<0&&!this.gameOver&&(this.gameOver=!0,this.g.music.play("dead"),this.ctrl.r.remove=!0,this.ctrl.l.remove=!0,this.ctrl.u.remove=!0,this.g.spawn("Drop",{x:this.p1.x,y:this.p1.y,i:"ded",floor:this.floor,scale:4}),this.g.addEvent({t:1e3,cb:()=>{this.g.changeState("Title")}}),this.g.addEvent({t:150,cb:()=>{this.g.spawn("Control",{y:this.g.h-200,x:30,text:"RETRY",cb:()=>{this.g.changeState("Main")}}),this.g.spawn("Control",{y:this.g.h-200,x:180,text:"RETRY",text:"TWEET",col:14,clickCol:12,cb:()=>{location="https://twitter.com/intent/tweet?&text=I+scored+"+this.score+"+in+Enjoy+The+Sunshine&via=eoinmcg&url="+encodeURI(location.href)}})}}),this.p1.remove=!0,this.score>this.g.hiScore&&(this.g.hiScore=this.score,this.g.spawn("Text",{y:102,text:"NEW HISCORE",fade:.001,col:2,scale:4}),this.g.spawn("Text",{y:100,text:"NEW HISCORE",fade:.001,scale:4}))),this.gameOver&&this.g.input.keys.Enter&&this.g.changeState("Main")}render(){const t=this.g;this.g.canvas.ctx.clearRect(0,0,t.w,t.h),this.bg.render(),t.draw.img(this.tree,5,15),this.g.ents.forEach(t=>t.render()),this.gameOver?t.fader>0&&t.draw.text("U DED",this.f,!1,t.h/2.2):(t.draw.text(this.score,this.ui2,160,14),t.draw.text(this.score,this.ui,160,10));let i=this.p1.lives+1;for(;i--;)t.draw.img(t.imgs.heart,t.w-25*i,20,4)}setUpEvents(){let t=this.bg.level.events,i=this.g;t.forEach(t=>{if(t.d){let s=t.d;t.d.p=this,this.g.addEvent({t:t.t,cb:()=>{i.spawn(t.n,s)}})}t.bg&&this.g.addEvent({t:t.t,cb:()=>{this.bg.level.col.bg=t.bg.col}})})}setUpTree(){let t=this.bg.level,i=t.tree;this.tree=this.mkTree(i[0],i[1],i[2]),this.nest=this.g.spawn("Nest",{x:t.nest[0],y:t.nest[1],p:this}),t.ledges.forEach(t=>{this.g.spawn("Ledge",t)})}mkTree(t,i,s){let e=this.g,a=e.H.mkCanvas(100,s),r=a.getContext("2d"),n=new h(a,r,e.data.pal),o=12;for(e.H.rnd;o--;)n.img(this.g.imgs.circle_8_11,t-26,25*o);return n.img(this.g.imgs.circle_2_5,t,i-10),n.rect(t,i,16,s,5),n.rect(t,i,4,s,6),a}}},m.ents={Sprite:p,Bird:class extends p{constructor(t,i){i.group="player",i.i="b",i.scale=4,i.frames=5,super(t,i),this.g=t,this.o=i,this.angle=0,this.anims={glide:{frames:[3],rate:.025},flap:{frames:[1,2,3],rate:.025},stand:{frames:[4,4,4,5],rate:.2}},this.changeAnim("glide"),this.gravity=9.8,this.vx=2.5,this.vy=0,this.maxVy=4.5,this.floor=i.p.floor-this.h/2,this.lives=2,this.poops=50,this.isHolding=!1,this.isStanding=!1,this.wasStanding=this.isStanding}update(t){super.update(t),this.isStanding=!1;let i=this.g.input.keys,s=i.ArrowLeft||this.p.ctrl.l.hurt,h=i.ArrowRight||this.p.ctrl.r.hurt,e=i.z||this.p.ctrl.u.hurt;this.vy+=this.gravity/4*t,this.vy>this.maxVy&&(this.vy=this.maxVy),this.vy<-this.maxVy&&(this.vy=-this.maxVy),this.y=~~(this.y+this.vy),this.checkStanding(),this.bindToScreen(),this.handleInput(e,s,h),this.isStanding?this.changeAnim("stand"):e?this.changeAnim("flap"):this.changeAnim("glide"),this.lastBoost=e,this.wasStanding=this.isStanding&&this.y===this.floor}render(){super.render();let t=this.g,i=this.w/2,s=i/2;this.isHolding&&t.draw.img(t.imgs[this.isHolding],this.x+s,this.y+i+s,3),this.isWearing&&t.draw.img(t.imgs[this.isWearing],this.x-2,this.y-i-4+(this.flip.x?1:0),4)}handleInput(t,i,s){let h=this.g;t&&(this.vy-=.15),this.poops&&t&&!this.wasStanding&&!this.lastBoost&&(this.poops-=1,h.audio.play("SHOOT"),h.spawn("Poo",{x:this.x,y:this.y+this.h/2,a:1.6,p:this.p,floor:this.floor})),i?(this.x-=this.vx*!this.isStanding,this.flip.x=1):s&&(this.x+=this.vx*!this.isStanding,this.flip.x=0)}bindToScreen(){let t=this.g;this.y>=this.floor&&(this.vy===this.maxVy?(this.vy=this.maxVy/-2.5,t.burst(this.x,this.floor,11,3),t.spawn("Boom",{x:this.x,y:this.y+this.h/2}),t.audio.play("JUMP")):(this.isStanding=!0,this.vy=0),this.y=this.floor),this.x<0&&(this.x=0),this.x>t.w-this.w&&(this.x=t.w-this.w),this.y<0&&(this.y=0,this.vy=this.maxVy/1.5)}checkStanding(){this.isStanding||this.g.ents.forEach(t=>{"Ledge"===t.constructor.name&&this.hit(t)&&this.vy>0&&(this.vy=0,this.y=t.y-this.h,this.isStanding=!0)})}hitBaddie(t){this.g.audio.play("JUMP"),this.hurt=!0,this.y-=-10,this.flip.x=!this.flip.x,this.x+=5,this.isHolding&&(this.g.spawn("Drop",{x:this.x,y:this.y,i:this.isHolding,floor:this.floor}),this.isHolding=!1),this.lives-=1,this.g.addEvent({t:100,cb:()=>{this.hurt=!1}})}},Ledge:class extends p{constructor(t,i){i.group="ledge",i.scale=4,i.h=1,i.col=3,super(t,i),this.collidesWith=["player"]}render(){this.g.draw.rect(this.x,this.y+6,this.w+16,this.h-7,5)}},Nest:class extends p{constructor(t,i){i.group="nest",i.scale=3,i.col=3,i.i="nest",super(t,i),this.collidesWith=["player"],this.items=[]}receiveDamage(t){if(t.isHolding){let i="phone"===t.isHolding?100:50;this.p.score+=i,this.items.push(t.isHolding),t.isHolding=!1,this.g.audio.play("POWERUP"),this.g.spawn("Text",{x:t.x,y:t.y,text:i,col:2})}}},Poo:class extends p{constructor(t,i){i.group="poo",i.i="poo",i.scale=3,super(t,i),this.g=t,this.o=i,this.speed=2,this.col=7,this.floor=i.p.floor,this.vx=this.speed*Math.cos(this.a),this.vy=this.speed*Math.sin(this.a)}update(t){this.x+=this.vx*this.speed,this.y+=this.vy*this.speed,this.y>this.floor&&(this.g.burst(this.x,this.y,6,3),this.remove=!0,this.g.audio.play("TIP")),this.isOffScreen()&&(this.remove=!0)}doDamage(t){this.remove=!0}hitBaddie(t){let i=this.g;i.boom(this.x,this.y),i.audio.play("TIP"),i.spawn("Text",{x:t.x,y:t.y,text:t.val,col:2}),this.p.score+=t.val,t.init(i.H.rnd(500,700))}},Human:class extends p{constructor(t,i){i.group="humans",i.frames=4,i.scale=4,i.i=`h${t.H.rnd(0,2)}`,super(t,i),this.speed=.5,this.floor=i.p.floor,this.y=this.floor-this.h/2,this.collidesWith=["player","poo"],this.anims={walk:{frames:[1,2],rate:.05},jump:{frames:[3,4],rate:.05}},this.changeAnim("walk"),this.flip.x=t.H.rnd(0,1),this.x=this.flip.x?t.w+this.w:-this.w,this.speed=this.flip.x?.5:-.5,this.isHolding=t.H.rndArray(["phone","phone","lolly","melon","bun"]),this.isWearing=t.H.rndArray(["hat0","hat1","hat2",!1,!1]),"Title"===i.p.constructor.name&&(this.isHolding="phone"),this.hasSwitched=!1}update(t){this.x-=this.speed*this.p.speed*(100*t),(this.x<-this.w||this.x>this.g.h+this.w)&&(this.remove=!0,this.g.addEvent({t:this.g.H.rnd(100,300),cb:()=>{this.g.spawn("Human",{p:this.p})}})),super.update(t)}render(){super.render();let t=this.i.width/2/2,i=this.g;if(this.isHolding){let s=this.flip.x?-t/2:t;i.draw.img(i.imgs[this.isHolding],this.x+s,this.y+4-this.frame,3)}if(this.isWearing){let t="jump"===this.anim.name?10:0;i.draw.img(i.imgs[this.isWearing],this.x+2,this.y+t-12-4*this.frame,4)}}receiveDamage(t){if("poo"===t.group)this.hurt=!0,this.speed=0,this.changeAnim("jump"),this.g.boom(this.x,this.y,2,3,0),this.g.addEvent({t:250,cb:()=>{this.hurt=!1,this.changeAnim("walk"),this.speed=this.flip.x?.5:-.5}});else if((this.isHolding||this.isWearing)&&!t.isStanding){if(this.hasSwitched)return;let i=t.isWearing;this.hasSwitched=!0,t.isHolding=this.isHolding,t.isWearing=this.isWearing,this.isHolding=!1,this.isWearing=!!this.hasSwitched&&i,this.changeAnim("jump"),this.g.audio.play("TAP"),this.speed=0,this.g.addEvent({t:500,cb:()=>{this.changeAnim("walk"),this.speed=this.flip.x?.5:-.5}})}}},Baddie:class extends p{constructor(t,i){i.group="baddies",i.frames=1,i.scale=3,i.vx=2,i.vy=0,i.val=20,"gull"===i.i&&(i.scale=5,i.vx=3,i.vy=2,i.val=50),super(t,i),this.val=20,this.floor=i.p.floor,this.collidesWith=["player","poo"],this.init()}init(t=0){this.x=-40,this.vx=0,this.vy=0,this.dir=this.g.H.rnd(0,1)>0?-1:1,this.g.addEvent({t:t,cb:()=>{this.y=this.g.H.rnd(this.yRange-20,this.yRange+20),this.x=1===this.dir?-40:this.g.w+this.w,this.vx=this.o.vx*this.dir,this.vy=this.o.vy,this.flip.x=-1===this.dir}})}update(t){this.remove||(super.update(t),this.x+=this.vx,this.y+=this.vy,(this.x>this.g.w+this.w||this.x<-50)&&this.init(this.g.H.rnd(100,200)))}render(){if(this.remove)return;super.render();let t=this.g;this.isHolding&&t.draw.img(t.imgs.phone,this.x-this.w/2,this.y+4-this.frame,3),this.isWearing&&t.draw.img(t.imgs[this.isWearing],this.x+2,this.y-7-this.frame,3)}receiveDamage(t){t.hurt||t.hitBaddie(this)}},Cat:class extends p{constructor(t,i){i.group="baddies",i.i="cat",i.scale=3,i.frames=2,super(t,i),this.val=100,this.y=i.p.floor-this.h/2,this.collidesWith=["player","poo"],this.anims={run:{frames:[1,2],rate:.025}},this.changeAnim("run"),this.init(220)}init(t=0){this.x=-40,this.speed=0,this.g.addEvent({t:t,cb:()=>{this.x=this.g.H.rnd(0,1)?-30:this.g.w+30,this.speed=2.5*(-30===this.x?1:-1),this.flip.x=this.speed<0}})}update(t){this.x+=this.speed,(this.x>=this.g.w+50||this.x<=-50)&&(this.speed=0,this.p.p1.wasStanding&&this.init(this.g.H.rnd(100,300))),super.update(t)}receiveDamage(t){"poo"===t.group?(t.hitBaddie(this),this.x=-50):"player"!==t.group||t.hurt||t.hitBaddie(this)}},Worm:class extends p{constructor(t,i){i.group="worms",i.i="worm",i.scale=2,i.val=10,super(t,i),this.y=i.p.floor-this.h/4,this.collidesWith=["player","bullets"],this.init(1e3)}init(t=0){this.x=-30,this.speed=0,this.dir=this.g.H.rnd(0,1)>0?-1:1,this.g.addEvent({t:t,cb:()=>{this.x=this.g.H.rnd(50,this.g.w-50)}})}update(t){this.g.H.rnd(0,100)>98&&(this.flip.x=!this.flip.x),super.update(t)}receiveDamage(t){t.poops=10,this.g.spawn("Text",{x:this.x,y:this.y,text:"YUM",col:4}),this.g.audio.play("POWERUP"),this.init(1e3)}},Drop:class extends p{constructor(t,i){i.scale=i.scale||3,super(t,i),this.gravity=9.8,this.vy=1,this.maxVy=4.5}update(t){this.vy+=this.gravity/4*t,this.y=~~(this.y+this.vy),this.vy>this.maxVy&&(this.vy=this.maxVy),this.vy<-this.maxVy&&(this.vy=-this.maxVy),this.y>this.floor+this.h&&(this.g.boom(this.x,this.y,3,4),this.remove=!0),super.update(t)}},Text:class{constructor(t,i){i.group="text",i.vy=i.vy||-2.5,i.vx=i.vx||0,i.w=10,i.w=10,i.alpha=1,i.scale=i.scale||3,i.col=i.col||4,i.accel=i.accel||.5,i.fade=i.fade||.01;for(let t in i)this[t]=i[t];this.g=t,this.p=t.imgs[`font_${i.scale}_${i.col}`]}update(t){(this.y<0||this.alpha<.1)&&(this.remove=!0),this.vy-=this.accel,this.alpha-=this.fade,this.vx&&(this.x+=this.vx*t),this.y+=this.vy*t}render(){let t=this.g.draw;this.text?t.text(this.text,this.p,this.x,this.y):this.o&&t.ctx.drawImage(this.i,this.x,this.y)}},Boom:class{constructor(t,i){i.col=i.col||2,this.g=t,this.i=t.draw.color(t.imgs.circle,t.data.pal[i.col]),this.startX=i.x,this.startY=i.y,this.magnitude=i.m||4,this.scale=1,this.factor=i.factor||.5}update(t){this.g,this.scale+=this.factor,this.scale>this.magnitude&&this.factor>0&&(this.factor*=-1),this.scale<=1&&(this.remove=!0)}render(){let t=this.i.width*this.scale/2,i=this.startX-t,s=this.startY-t;this.g.draw.img(this.i,i,s,this.scale)}},Particle:class{constructor(t,i){this.g=t,this.x=i.x,this.y=i.y,this.w=i.w||3,this.h=this.w,this.vx=t.H.rnd(-100,100),this.vy=-1*t.H.rnd(0,150),this.col=i.col||6,this.r=i.r||1,this.i=t.imgs[`dot_${this.w}_${this.col}`]}update(t){this.x+=this.vx*t,this.y+=this.vy*t,this.vy+=5,this.y>this.g.h&&(this.remove=!0)}render(t){this.g.draw.ctx.drawImage(this.i,this.x,this.y)}},Control:class extends p{constructor(t,i){i.scale=5,i.i||(i.size=i.size||4,i.w=i.w||110,i.h=i.h||40,i.col=i.col||7),super(t,i),this.flip.x=!!i.flip,i.i||(this.x=i.x||t.w/2-i.w/2,this.p=t.imgs[`font_${i.size}_2`],this.pHover=t.imgs[`font_${i.size}_2`],this.clicked=!1,this.clickCol=i.clickCol||3,this.currentCol=this.col,this.clicked=!1,this.tX=i.x?i.x+20:t.w/2-t.draw.textWidth(this.text,this.p)/2),this.origX=this.x,this.origY=i.y}update(t){let i=this.checkTouch()||this.checkClick();this.hover=this.intersects(this.g.input.m),this.currentCol=this.hover?this.clickCol:this.col,i&&this.cb?this.cb.call(this):i?(this.hurt=!0,this.x=this.origX+3,this.y=this.origY+3):(this.hurt=!1,this.x=this.origX,this.y=this.origY)}render(){if(this.i)super.render();else{let t=this.hover?this.pHover:this.p;this.g.draw.rect(this.x,this.y,this.w,this.h,this.currentCol),this.g.draw.text(this.text,t,this.tX,this.y+5)}}intersects(t){return t.x>this.x&&t.x<this.x+this.w&&t.y>this.y&&t.y<this.y+this.h}checkClick(){let t=this.g.input.m;return t.click&&this.hit(t)}checkTouch(){let t=this.g.input.m.touches,i=t.length;for(;i--;)if(t[i].x>=this.x&&t[i].x<=this.x+this.w)return!0;return!1}}},new class{constructor(t){let i=navigator.userAgent.toLowerCase();this.mobile="createTouch"in document||!1,this.android=i.indexOf("android")>-1,this.ios=/ipad|iphone|ipod/.test(i),this.firefox=i.indexOf("firefox")>-1,this.data=t,this.w=t.w,this.h=t.h,this.dt=0,this.fps=60,this.frameStep=1/this.fps,this.frameCurr=0,this.framePrev=s.timeStamp(),this.stateName=t.start,this.H=s,this.states=t.states,this.availEnts=t.ents,this.score=0,this.hiScore=200,this.plays=0,this.ents=[],this.imgs=[],this.fonts=[],this.events=[],this.init()}init(){const s=new t(this.data.i);document.title=this.data.title,this.canvas=new i(this.data.w,this.data.h),this.draw=new h(this.canvas.c,this.canvas.ctx,this.data.pal),this.input=new e(this.canvas.c,this),this.audio={play(){}},this.music={play(){},stop(){}},s.start().then(t=>{this.imgs=t,this.data.scale.forEach(t=>{this.scaleUp(t)}),document.getElementById("l").style.display="none",this.changeState(this.stateName),this.canvas.c.style.display="block",this.favIcon(this.draw.resize(this.imgs.lolly,12)),this.loop()})}initAudio(){this.ios||(this.audio=r,this.audio.init(this,this.data.sfx),this.music=new A(this.data.instruments,this.data.tracks))}scaleUp(t){let i=16;for(;i--;){let s=this.data.pal.length;for(;s--;){let h=this.draw.color(this.imgs[t],this.data.pal[s]);this.imgs[`${t}_${i}_${s}`]=this.draw.resize(h,i)}}}favIcon(t){let i=document.createElement("canvas"),s=i.getContext("2d"),h=document.createElement("link");i.width=64,i.height=64,s.drawImage(t,0,0),h.type="image/x-icon",h.rel="shortcut icon",h.href=i.toDataURL("image/x-icon"),document.getElementsByTagName("head")[0].appendChild(h)}changeState(t){this.ents=[],this.events=[],this.state=new this.states[t](this),this.music.stop(),this.state.init()}loop(){for(this.frameCurr=s.timeStamp(),this.dt=this.dt+Math.min(1,(this.frameCurr-this.framePrev)/1e3);this.dt>this.frameStep;)this.dt=this.dt-this.frameStep,this.update(this.frameStep);this.render(this.dt),this.framePrev=this.frameCurr,requestAnimationFrame(()=>this.loop())}update(t){this.fader=Math.sin(.005*(new Date).getTime()),this.runEvents(t),this.state.update(t);let i=this.ents.length;for(;i--;)this.ents[i].remove&&this.ents.splice(i,1)}render(t){this.state.render(t)}spawn(t,i){const s=new this.availEnts[t](this,i);return this.ents.push(s),s}boom(t,i,s=2,h=1,e=8){this.audio.play("BOOM"),this.spawn("Boom",{x:t,y:i,m:e,col:s}),this.burst(t,i,s,h)}burst(t,i,s,h,e=3){for(;h--;)this.ents.push(new this.availEnts.Particle(this,{x:t,y:i,col:s,w:e}))}addEvent(t){this.events.push(t)}runEvents(t){let i=this.events.length;for(;i--;){let s=this.events[i];if(!s)break;s.t-=100*t,s.t<0&&(s.cb.call(this),this.events.splice(i,1))}}}(m)}();</script></body</html>